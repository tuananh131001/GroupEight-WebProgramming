<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>bs5 edit profile account details - Bootdey.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <%- include('./partials/header.ejs') %>
    <div class="container-xl px-4 mt-4">
        <hr class="mt-0 mb-4">
        <div class="row">
            <div class="col-xl-4">
                <div class="card mb-4 mb-xl-0">
                    <div class="card-header">Profile Picture</div>
                    <div class="card-body text-center">
                      <img class="img-account-profile rounded-circle mb-2" src="http://bootdey.com/img/Content/avatar/avatar1.png" alt>
                      <div class="small font-italic text-muted mb-4">JPG or PNG no larger than 5 MB</div>
                      <input type="file" id="avatarInput" accept="image/jpeg, image/png" style="display: none;">
                      <label for="avatarInput" class="btn btn-primary">Upload new image</label>
                    </div>
                </div>
            </div>
            <div class="col-xl-8">
                <div class="card mb-4">
                    <div class="card-header">Account Details</div>
                    <div class="card-body">
                        <form id="profileForm">
                            <div class="mb-3">
                                <label class="small mb-1" for="inputUsername">Username</label>
                                <input class="form-control" id="inputUsername" type="text" placeholder="Enter your username" readonly>
                                <div id="usernameValidation" class="text-danger"></div>
                            </div>
                            <div class="mb-3">
                                <label class="small mb-1" for="inputRole">Role</label>
                                <select class="form-select" id="inputRole" disabled>
                                    <option value="customer">Customer</option>
                                    <option value="vendor">Vendor</option>
                                    <option value="shipper">Shipper</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="small mb-1" for="inputName">Name</label>
                                <input class="form-control" id="inputName" type="text" placeholder="Enter your Name" readonly>
                                <div id="nameValidation" class="text-danger"></div>
                            </div>
                            <div class="row gx-3 mb-3">
                                <div class="col-md-6" id="businessNameContainer">
                                    <label class="small mb-1" for="inputBusinessName">Business Name</label>
                                    <input class="form-control" id="inputBusinessName" type="text" placeholder="Enter your Business Name" readonly>
                                </div>
                                <div class="col-md-6" id="businessAddressContainer">
                                    <label class="small mb-1" for="inputBusinessAddress">Business Address</label>
                                    <input class="form-control" id="inputBusinessAddress" type="text" placeholder="Enter your Business Address" readonly>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="small mb-1" for="inputLocation">Location</label>
                                <input class="form-control" id="inputLocation" type="text" placeholder="Enter your Location" readonly>
                                <div id="locationValidation" class="text-danger"></div>
                            </div>
                            <!-- Distribution Hubs Select for Shipper -->
                            <div class="mb-3" id="distributionHubContainer" style="display: none;">
                                <label class="small mb-1" for="inputDistributionHub">Distribution Hub</label>
                                <select class="form-select" id="inputDistributionHub">
                                    <option value="hub1">Distribution Hub 1</option>
                                    <option value="hub2">Distribution Hub 2</option>
                                    <option value="hub3">Distribution Hub 3</option>
                                </select>
                            </div>
                            <!-- End of Distribution Hubs Select -->
                            <button class="btn btn-primary" type="button" id="editProfileBtn">Edit Profile</button>
                            <button class="btn btn-success" type="button" id="saveProfileBtn" style="display: none;">Save Profile</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
        // Function to enable editing mode
        function enableEditing() {
            $("input, select").prop("readonly", false);
            $("#inputRole").prop("disabled", false); // Enable role selection
            $("#saveProfileBtn").show();
            $("#editProfileBtn").hide();
        }

        // Function to hide/show business name and address based on role
        function updateBusinessFieldsVisibility() {
            var selectedRole = $("#inputRole").val();
            if (selectedRole === "customer" || selectedRole === "shipper") {
                // Hide the business name and address fields
                $("#businessNameContainer").hide();
                $("#businessAddressContainer").hide();
                if (selectedRole === "shipper") {
                    // Show the distribution hub select for Shipper
                    $("#distributionHubContainer").show();
                } else {
                    // Hide the distribution hub select for other roles
                    $("#distributionHubContainer").hide();
                }
            } else {
                // Show the business name and address fields for other roles
                $("#businessNameContainer").show();
                $("#businessAddressContainer").show();
                // Hide the distribution hub select
                $("#distributionHubContainer").hide();
            }
        }

        // Function to validate the username
        function validateUsername(username) {
            // Username must contain only letters (lower and upper case) and digits
            var regex = /^[a-zA-Z0-9]+$/;
            return regex.test(username) && username.length >= 8 && username.length <= 15;
        }

        // Function to validate other fields (name and location)
        function validateField(fieldValue) {
            // Other fields must have a minimum length of 5 characters
            return fieldValue.length >= 5;
        }

        // Function to save changes
        function saveChanges() {
            var username = $("#inputUsername").val();
            var name = $("#inputName").val();
            var location = $("#inputLocation").val();

            var isUsernameValid = validateUsername(username);
            var isNameValid = validateField(name);
            var isLocationValid = validateField(location);

            // Display validation messages
            $("#usernameValidation").text(isUsernameValid ? "" : "Username is invalid.");
            $("#nameValidation").text(isNameValid ? "" : "Name must have at least 5 characters.");
            $("#locationValidation").text(isLocationValid ? "" : "Location must have at least 5 characters.");

            // Check if all fields are valid before saving
            if (isUsernameValid && isNameValid && isLocationValid) {
                // Update visibility before saving
                updateBusinessFieldsVisibility();
                // Save data here
                // Add your save logic here (e.g., saving to a database or updating a server)
                // After successful save, you can re-disable input fields and show the edit button
                $("input, select").prop("readonly", true);
                $("#inputRole").prop("disabled", true); // Disable role selection
                $("#saveProfileBtn").hide();
                $("#editProfileBtn").show();
                alert('Changes saved successfully.');
            } else {
                // If any field is invalid, prevent saving and keep the edit mode
                return;
            }
        }

        // Function to load data from localStorage
        function loadData() {
            // ... (rest of the loadData -function remains the same)
            updateBusinessFieldsVisibility(); // Update visibility when loading data
        }

        // Load data when the page loads
        loadData();

        $("#editProfileBtn").click(enableEditing);

        $("#inputRole").change(function () {
            // Handle role change event to update field visibility
            updateBusinessFieldsVisibility();
        });

        $("#saveProfileBtn").click(function () {
            saveChanges();
        });
        $("#avatarInput").change(function (e) {
            var file = e.target.files[0];
            if (file) {
                // Handle the selected file (e.g., display a preview or perform other actions)
                // You can add code here to display the selected image as a preview if needed
                console.log("Selected file:", file);
            }
        });
    });
    </script>
</body>
</html>
